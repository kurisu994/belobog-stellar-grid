---
alwaysApply: true
---

> **AI 助手项目规则** - `belobog-stellar-grid` 核心约束和代码修改指南

---


## 模块结构
```
src/
├── lib.rs              # 仅模块声明和重导出，无业务逻辑
├── validation.rs       # 文件名验证
├── resource.rs         # RAII 资源管理
├── core/
│   ├── mod.rs          # 统一 API
│   ├── table_extractor.rs  # 数据提取
│   ├── export_csv.rs   # CSV 导出
│   └── export_xlsx.rs # XLSX 导出
├── batch_export.rs     # 异步分批导出
└── utils.rs
```

## 核心约束
- 文件名必须通过 `validate_filename()` 验证
- DOM 操作必须检查返回值
- 使用 `Result<T, JsValue>` 而非 `panic!`
- 中文错误消息
- Blob URL 必须用 `UrlGuard` 管理
- 参数优先使用 `&str` 引用

## 发布流程
```bash
just bump patch/minor/major    # 升级版本
git add . && git commit -m "chore: bump version"
just publish latest/beta/next  # 发布到 npm
```

## 测试
```bash
cargo test              # 运行所有测试 (47个)
cargo clippy -- -D warnings
cargo fmt
```

## 重要路径
- 核心 API: `src/core/mod.rs`
- 数据提取: `src/core/table_extractor.rs`
- 验证: `src/validation.rs`
- 资源: `src/resource.rs`
- 测试: `tests/lib_tests.rs` (35), `tests/test_resource.rs` (8), `tests/test_unified_api.rs` (4)

---

## 关键设计原则

1. **简洁至上** - 最简单的解决方案
2. **安全第一** - 验证输入、优雅错误处理、中文消息
3. **模块化** - 清晰的职责分离
4. **性能优化** - 零拷贝 + 分批异步 + RAII