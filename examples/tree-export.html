<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>belobog-stellar-grid - æ ‘å½¢æ•°æ®å¯¼å‡ºç¤ºä¾‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
                         'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 { color: #333; margin-bottom: 8px; }
        .subtitle { color: #666; font-size: 1rem; }
        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 20px;
        }
        .back-link:hover { text-decoration: underline; }
        .scenario {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        .scenario h2 {
            color: #333;
            font-size: 1.2rem;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            padding-left: 12px;
        }
        .scenario p {
            color: #666;
            margin-bottom: 16px;
            line-height: 1.6;
        }
        .btn-group { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
        }
        .btn-csv { background: #52c41a; color: #fff; }
        .btn-csv:hover { background: #389e0d; }
        .btn-xlsx { background: #1890ff; color: #fff; }
        .btn-xlsx:hover { background: #096dd9; }
        .btn-disabled { background: #d9d9d9; color: #999; cursor: not-allowed; }
        .status {
            padding: 10px 16px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            font-size: 0.9rem;
        }
        .status.success { display: block; background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .status.error { display: block; background: #fff2f0; color: #ff4d4f; border: 1px solid #ffa39e; }
        pre {
            background: #f5f5f5;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 16px;
        }
        .data-preview {
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background: #fafafa;
        }
        .data-preview h3 {
            color: #555;
            font-size: 0.95rem;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† è¿”å›ç¤ºä¾‹åˆ—è¡¨</a>
        <header>
            <h1>ğŸŒ³ æ ‘å½¢æ•°æ®å¯¼å‡ºç¤ºä¾‹</h1>
            <p class="subtitle">å°†åµŒå¥—çš„ children ç»“æ„é€’å½’æ‹å¹³åå¯¼å‡ºï¼Œæ”¯æŒå±‚çº§ç¼©è¿›</p>
        </header>

        <!-- åœºæ™¯ 1ï¼šåŸºæœ¬æ ‘å½¢ç»“æ„ -->
        <div class="scenario">
            <h2>åœºæ™¯ 1ï¼šç»„ç»‡æ¶æ„å¯¼å‡º</h2>
            <p>å…¸å‹çš„æ ‘å½¢æ•°æ®â€”â€”å…¬å¸ç»„ç»‡æ¶æ„ï¼Œä½¿ç”¨ <code>children</code> è¡¨ç¤ºä¸Šä¸‹çº§å…³ç³»ã€‚</p>
            <div class="data-preview">
                <h3>ğŸ“‹ æ•°æ®é¢„è§ˆ</h3>
<pre>
CEO (å¼ ä¸‰)
â”œâ”€â”€ CTO (æå››)
â”‚   â”œâ”€â”€ å‰ç«¯ç»„é•¿ (ç‹äº”)
â”‚   â””â”€â”€ åç«¯ç»„é•¿ (èµµå…­)
â”œâ”€â”€ CFO (å­™ä¸ƒ)
â”‚   â””â”€â”€ ä¼šè®¡ (å‘¨å…«)
â””â”€â”€ COO (å´ä¹)
</pre>
            </div>
            <div class="btn-group">
                <button class="btn-csv" onclick="exportScenario1('csv')">ğŸ“„ å¯¼å‡º CSV</button>
                <button class="btn-xlsx" onclick="exportScenario1('xlsx')">ğŸ“Š å¯¼å‡º XLSX</button>
                <button class="btn-csv" onclick="exportScenario1('csv', true)">ğŸ“„ CSV (å¸¦ç¼©è¿›)</button>
                <button class="btn-xlsx" onclick="exportScenario1('xlsx', true)">ğŸ“Š XLSX (å¸¦ç¼©è¿›)</button>
            </div>
            <div id="status1" class="status"></div>
        </div>

        <!-- åœºæ™¯ 2ï¼šå¤šçº§åˆ†ç±»ç›®å½• -->
        <div class="scenario">
            <h2>åœºæ™¯ 2ï¼šå•†å“åˆ†ç±»ç›®å½•</h2>
            <p>ç”µå•†å¸¸è§çš„å¤šçº§åˆ†ç±»æ ‘ï¼Œæ”¯æŒè‡ªå®šä¹‰å­èŠ‚ç‚¹å­—æ®µåï¼ˆå¦‚ <code>subCategories</code>ï¼‰ã€‚</p>
            <div class="data-preview">
                <h3>ğŸ“‹ æ•°æ®é¢„è§ˆ</h3>
<pre>
ç”µå­äº§å“
â”œâ”€â”€ æ‰‹æœº
â”‚   â”œâ”€â”€ æ™ºèƒ½æ‰‹æœº
â”‚   â””â”€â”€ åŠŸèƒ½æ‰‹æœº
â”œâ”€â”€ ç”µè„‘
â”‚   â”œâ”€â”€ ç¬”è®°æœ¬
â”‚   â””â”€â”€ å°å¼æœº
æœè£…
â”œâ”€â”€ ç”·è£…
â””â”€â”€ å¥³è£…
    â””â”€â”€ è¿è¡£è£™
</pre>
            </div>
            <div class="btn-group">
                <button class="btn-xlsx" onclick="exportScenario2()">ğŸ“Š å¯¼å‡º XLSXï¼ˆå¸¦ç¼©è¿›ï¼‰</button>
            </div>
            <div id="status2" class="status"></div>
        </div>

        <!-- åœºæ™¯ 3ï¼šåµŒå¥—è¡¨å¤´ + æ ‘å½¢æ•°æ® -->
        <div class="scenario">
            <h2>åœºæ™¯ 3ï¼šåµŒå¥—è¡¨å¤´ + æ ‘å½¢æ•°æ®</h2>
            <p>è¡¨å¤´é…ç½®ä¸ºå¤šå±‚åµŒå¥—ç»“æ„ï¼ˆåˆ†ç»„åˆ—ï¼‰ï¼Œæ•°æ®ä¹Ÿæ˜¯æ ‘å½¢ç»“æ„ï¼Œä¸¤è€…ç‹¬ç«‹ï¼šè¡¨å¤´åµŒå¥—æ§åˆ¶åˆ—çš„åˆ†ç»„åˆå¹¶ï¼Œæ•°æ®åµŒå¥—æ§åˆ¶è¡Œçš„å±‚çº§æ‹å¹³ã€‚</p>
            <div class="data-preview">
                <h3>ğŸ“‹ æ•°æ®é¢„è§ˆ</h3>
<pre>
åˆ—é…ç½®: éƒ¨é—¨ | è¯¦æƒ… â†’ (è´Ÿè´£äºº, äººæ•°)
æ•°æ®:
æŠ€æœ¯éƒ¨ (å¼ ä¸‰, 100)
â”œâ”€â”€ å‰ç«¯ç»„ (æå››, 30)
â””â”€â”€ åç«¯ç»„ (ç‹äº”, 70)
    â””â”€â”€ æ•°æ®åº“ç»„ (èµµå…­, 20)
</pre>
            </div>
            <div class="btn-group">
                <button class="btn-xlsx" onclick="exportScenario3()">ğŸ“Š å¯¼å‡º XLSXï¼ˆåµŒå¥—è¡¨å¤´ + æ ‘å½¢æ•°æ®ï¼‰</button>
            </div>
            <div id="status3" class="status"></div>
        </div>

        <!-- åœºæ™¯ 4ï¼šå¤§æ•°æ®é‡æ ‘ -->
        <div class="scenario">
            <h2>åœºæ™¯ 4ï¼šå¤§æ•°æ®é‡æ ‘å½¢ç»“æ„</h2>
            <p>åŠ¨æ€ç”ŸæˆåŒ…å«æ•°ç™¾ä¸ªèŠ‚ç‚¹çš„æ ‘å½¢æ•°æ®ï¼Œæµ‹è¯•æ€§èƒ½ã€‚</p>
            <div class="btn-group">
                <button class="btn-xlsx" onclick="exportScenario4()">ğŸ“Š å¯¼å‡º XLSXï¼ˆ500+ èŠ‚ç‚¹ï¼‰</button>
            </div>
            <div id="status4" class="status"></div>
        </div>
    </div>

    <script type="module">
        import init, { export_data, ExportFormat } from '../pkg/belobog_stellar_grid.js';

        await init();

        function showStatus(id, success, message) {
            const el = document.getElementById(id);
            el.className = success ? 'status success' : 'status error';
            el.textContent = message;
        }

        // ===== åœºæ™¯ 1ï¼šç»„ç»‡æ¶æ„ =====
        const orgData = [
            {
                id: 1, name: 'CEO - å¼ ä¸‰', title: 'CEO', level: 'é«˜ç®¡',
                children: [
                    {
                        id: 2, name: 'CTO - æå››', title: 'CTO', level: 'é«˜ç®¡',
                        children: [
                            { id: 5, name: 'å‰ç«¯ç»„é•¿ - ç‹äº”', title: 'ç»„é•¿', level: 'ä¸­å±‚' },
                            { id: 6, name: 'åç«¯ç»„é•¿ - èµµå…­', title: 'ç»„é•¿', level: 'ä¸­å±‚' },
                        ]
                    },
                    {
                        id: 3, name: 'CFO - å­™ä¸ƒ', title: 'CFO', level: 'é«˜ç®¡',
                        children: [
                            { id: 7, name: 'ä¼šè®¡ - å‘¨å…«', title: 'ä¼šè®¡', level: 'åŸºå±‚' },
                        ]
                    },
                    { id: 4, name: 'COO - å´ä¹', title: 'COO', level: 'é«˜ç®¡' },
                ]
            }
        ];

        const orgColumns = [
            { title: 'ID', key: 'id' },
            { title: 'å§“å', key: 'name' },
            { title: 'èŒä½', key: 'title' },
            { title: 'å±‚çº§', key: 'level' },
        ];

        window.exportScenario1 = function(fmt, indent) {
            try {
                const format = fmt === 'xlsx' ? ExportFormat.Xlsx : ExportFormat.Csv;
                const filename = indent ? `ç»„ç»‡æ¶æ„_ç¼©è¿›.${fmt}` : `ç»„ç»‡æ¶æ„.${fmt}`;
                export_data(
                    orgData,
                    orgColumns,
                    filename,
                    format,
                    undefined,                     // progress_callback
                    indent ? 'name' : undefined,   // indent_column
                    indent ? 'children' : undefined // children_key
                );
                showStatus('status1', true, `âœ… å¯¼å‡ºæˆåŠŸ: ${filename}`);
            } catch(e) {
                showStatus('status1', false, `âŒ å¯¼å‡ºå¤±è´¥: ${e}`);
            }
        };

        // ===== åœºæ™¯ 2ï¼šå•†å“åˆ†ç±»ï¼ˆè‡ªå®šä¹‰ children_keyï¼‰=====
        const categoryData = [
            {
                id: 1, name: 'ç”µå­äº§å“', code: 'ELEC',
                subCategories: [
                    {
                        id: 2, name: 'æ‰‹æœº', code: 'PHONE',
                        subCategories: [
                            { id: 5, name: 'æ™ºèƒ½æ‰‹æœº', code: 'SMART' },
                            { id: 6, name: 'åŠŸèƒ½æ‰‹æœº', code: 'FEATURE' },
                        ]
                    },
                    {
                        id: 3, name: 'ç”µè„‘', code: 'PC',
                        subCategories: [
                            { id: 7, name: 'ç¬”è®°æœ¬', code: 'LAPTOP' },
                            { id: 8, name: 'å°å¼æœº', code: 'DESKTOP' },
                        ]
                    },
                ]
            },
            {
                id: 4, name: 'æœè£…', code: 'CLOTH',
                subCategories: [
                    { id: 9, name: 'ç”·è£…', code: 'MALE' },
                    {
                        id: 10, name: 'å¥³è£…', code: 'FEMALE',
                        subCategories: [
                            { id: 11, name: 'è¿è¡£è£™', code: 'DRESS' },
                        ]
                    },
                ]
            },
        ];

        const categoryColumns = [
            { title: 'ID', key: 'id' },
            { title: 'åˆ†ç±»åç§°', key: 'name' },
            { title: 'ç¼–ç ', key: 'code' },
        ];

        window.exportScenario2 = function() {
            try {
                export_data(
                    categoryData,
                    categoryColumns,
                    'å•†å“åˆ†ç±».xlsx',
                    ExportFormat.Xlsx,
                    undefined,         // progress_callback
                    'name',            // indent_column
                    'subCategories',   // è‡ªå®šä¹‰ children_key
                );
                showStatus('status2', true, 'âœ… å¯¼å‡ºæˆåŠŸ: å•†å“åˆ†ç±».xlsx');
            } catch(e) {
                showStatus('status2', false, `âŒ å¯¼å‡ºå¤±è´¥: ${e}`);
            }
        };

        // ===== åœºæ™¯ 3ï¼šåµŒå¥—è¡¨å¤´ + æ ‘å½¢æ•°æ® =====
        const nestedColumns = [
            { title: 'éƒ¨é—¨', key: 'dept' },
            {
                title: 'è¯¦æƒ…',
                children: [
                    { title: 'è´Ÿè´£äºº', key: 'leader' },
                    { title: 'äººæ•°', key: 'count' },
                ]
            },
        ];

        const deptTreeData = [
            {
                dept: 'æŠ€æœ¯éƒ¨', leader: 'å¼ ä¸‰', count: 100,
                children: [
                    { dept: 'å‰ç«¯ç»„', leader: 'æå››', count: 30 },
                    {
                        dept: 'åç«¯ç»„', leader: 'ç‹äº”', count: 70,
                        children: [
                            { dept: 'æ•°æ®åº“ç»„', leader: 'èµµå…­', count: 20 },
                        ]
                    },
                ]
            },
        ];

        window.exportScenario3 = function() {
            try {
                export_data(
                    deptTreeData,
                    nestedColumns,
                    'éƒ¨é—¨æ¶æ„.xlsx',
                    ExportFormat.Xlsx,
                    undefined,    // progress_callback
                    'dept',       // indent_column
                    'children',   // children_key
                );
                showStatus('status3', true, 'âœ… å¯¼å‡ºæˆåŠŸ: éƒ¨é—¨æ¶æ„.xlsx');
            } catch(e) {
                showStatus('status3', false, `âŒ å¯¼å‡ºå¤±è´¥: ${e}`);
            }
        };

        // ===== åœºæ™¯ 4ï¼šå¤§æ•°æ®é‡æ ‘ =====
        function generateLargeTree(depth, breadth, prefix = '') {
            const nodes = [];
            for (let i = 1; i <= breadth; i++) {
                const id = `${prefix}${i}`;
                const node = {
                    id: id,
                    name: `èŠ‚ç‚¹_${id}`,
                    value: Math.floor(Math.random() * 1000),
                    status: Math.random() > 0.5 ? 'å¯ç”¨' : 'ç¦ç”¨',
                };
                if (depth > 1) {
                    node.children = generateLargeTree(depth - 1, breadth, `${id}-`);
                }
                nodes.push(node);
            }
            return nodes;
        }

        const largeColumns = [
            { title: 'ID', key: 'id' },
            { title: 'åç§°', key: 'name' },
            { title: 'å€¼', key: 'value' },
            { title: 'çŠ¶æ€', key: 'status' },
        ];

        window.exportScenario4 = function() {
            try {
                const start = performance.now();
                const data = generateLargeTree(4, 5); // 5^4 = 625 å¶å­èŠ‚ç‚¹
                export_data(
                    data,
                    largeColumns,
                    'å¤§æ•°æ®é‡æ ‘.xlsx',
                    ExportFormat.Xlsx,
                    undefined,    // progress_callback
                    'name',       // indent_column
                    'children',   // children_key
                );
                const elapsed = (performance.now() - start).toFixed(0);
                showStatus('status4', true, `âœ… å¯¼å‡ºæˆåŠŸï¼Œè€—æ—¶: ${elapsed}ms`);
            } catch(e) {
                showStatus('status4', false, `âŒ å¯¼å‡ºå¤±è´¥: ${e}`);
            }
        };
    </script>
</body>
</html>
